# 並行性

- 「並行処理」とは複数のコードがあたかも同時に実行されているかのように振る舞うこと
    - 実行中にコードの異なる部分に制御を切り替えられるような環境でコードを実行する必要がある
    - ファイバー、スレッド、プロセス
- 「並列処理」とは複数のコードが本当に同時に実行されること
    - ２つの物事を同時に実行できるハードウェアが必要になる

### すべては並行処理

- 並行処理という観点を盛り込まずに進めることはほぼ不可能
- コードの間以外にも「時間的結合」が存在
    - システムが動作する順番にも柔軟性がないとだめ
- 並行処理や並列処理が難しい
    - 逐次的システムを使ってプログラムを学習した
    - 使用している言語自体が逐次的
    - 最大の問題は状態の共有
- アクターモデルを使用する
    - データを共有しない独立したプロセスが、明確に定義されたシンプルなセマンティックスを用い、チャンネルを介して通信する
- ホワイトボード
    - オブジェクトストアと、スマートなPubSubの組み合わせとして機能するシステム

## 時間的な結合を破壊する

- 並行性（同時に発生すること）と順序（時間軸上における相対的な位置関係）
- プログラムの実行順序が指定されると柔軟性、現実性が乏しいものになる

### 並行部分を探す

- アクティビティ図といった表記法を用いてワークフローを補足する
- **並行性を向上させるためにワークフローを分析する**

### 並行処理の機会

- データベースのキューイング、外部サービスへのアクセス、ユーザーからの入力待ちといったものすべては完了までシステムを停止させる
- ここでより有益な仕事をサせるようにする

### 並列処理の機会

- 分割したここの作業が比較的独立していて他の作業を待つという状況がないもの
- Elixirのコンパイラ

### 機会の洗い出しは難しくない

- あとはいかに安全に実装するか

## 共有状態は間違った状態

- **共有状態は間違った状態**
- 2つのプロセスが同じメモリ領域に書き込めるところが問題
    - どちらのプロセスも参照したメモリの整合性を保証できない

セマフォー、そしてその他の相互排除形式

- セマフォーは、ある時点で誰か一人しか専有できない「何らかのもの」
- 伝統的にセマフォーを取得する操作は「P」、返却する操作は「V」と呼ばれていた
- 今日では「ロック/アンロック」、「取得/解放」となる

リソースをトランザクション化する

- 単一の呼び出しで一括化する
